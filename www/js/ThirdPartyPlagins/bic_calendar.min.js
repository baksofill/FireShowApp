/*
 *  Bic Calendar - v3.2.2
 *  A simple twitter bootstrap calendar / agenda to mark events and select range of dates.
 *  http://bichotll.github.io/bic_calendar
 *
 *  Made by bichotll
 *  Under Apache License
 */
$.fn.bic_calendar = function (a) {
    var b = $.extend({}, $.fn.bic_calendar.defaults, a);
    return this.each(function () {
        function a() {
            n = $('<table class="table">'), d();
            var a = o.getMonth(), b = o.getFullYear();
            e(a, b);
            var f = $('<td><a href="#" class="button-month-next"><i class="glyphicon glyphicon-arrow-right" ></i></a></td>');
            f.click(function (d) {
                d.preventDefault(), a = (a + 1) % 12, 0 == a && b++, c(a, b)
            });
            var g = $('<td><a href="#" class="button-month-previous"><i class="glyphicon glyphicon-arrow-left" ></i></a></td>');
            g.click(function (d) {
                d.preventDefault(), a -= 1, -1 == a && (b--, a = 11), c(a, b)
            });
            var h = $('<td><a href="#" class="button-year-next"><i class="glyphicon glyphicon-arrow-right" ></i></a></td>');
            h.click(function (d) {
                d.preventDefault(), b++, c(a, b)
            });
            var j = $('<td><a href="#" class="button-year-previous"><i class="glyphicon glyphicon-arrow-left" ></i></a></td>');
            j.click(function (d) {
                d.preventDefault(), b--, c(a, b)
            });
            var l = $('<table class="table header"></table>');
            if (E === !0) {
                var t = $("<tr></tr>"), u = $('<td colspan=5 class="monthAndYear span6"></td>');
                t.append(j), t.append(u), t.append(h), u.append(r), l.append(t)
            }
            if (D === !0) {
                var v = $("<tr></tr>"), w = $('<td colspan=5 class="monthAndYear span6"></td>');
                v.append(g), v.append(w), v.append(f), w.append(q), l.append(v)
            }
            m = $('<div class="bic_calendar row" id="' + s + '" ></div>'), m.prepend(l), m.append(n), p.append(m), i(a, b), k()
        }

        function c(a, b) {
            n.empty(), d(), e(a, b), i(a, b), l()
        }

        function d() {
            if (0 != x) {
                var a = $('<tr class="days-month" >'), b = "";
                $(v).each(function (a, c) {
                    b += "<td", 0 == a && (b += ' class="first"'), 6 == a && (b += ' class="sunday last"'), b += ">" + c + "</td>"
                }), b += "</tr>", a.append(b), n.append(a)
            }
        }

        function e(a, b) {
            q.text(w[a]), r.text(b);
            for (var c = 1, d = f(1, a, b), e = h(a, b), g = a + 1, i = "", j = 0; 7 > j; j++) {
                if (d > j) {
                    var k = "";
                    0 == j && (k += "<tr>"), k += '<td class="invalid-day week-day-' + j + '"', k += '"></td>'
                } else {
                    var k = "";
                    0 == j && (k += "<tr>"), k += '<td id="' + s + "_" + c + "_" + g + "_" + b + '" data-date="' + g + "/" + c + "/" + b + '" ', k += ' class="day week-day-' + j + '"', k += "><div><a>" + c + "</a></div></span>", 6 == j && (k += "</tr>"), c++
                }
                i += k
            }
            for (var l = 1; e >= c;) {
                var k = "";
                l % 7 == 1 && (k += "<tr>"), k += '<td id="' + s + "_" + c + "_" + g + "_" + b + '" data-date="' + g + "/" + c + "/" + b + '" ', k += ' class="day week-day-' + (l - 1) % 7 + '"', k += "><div><a>" + c + "</a></div></td>", l % 7 == 0 && (k += "</tr>"), c++, l++, i += k
            }
            if (l--, l % 7 != 0) {
                k = "";
                for (var j = l % 7 + 1; 7 >= j; j++) {
                    var k = "";
                    k += "<td ", k += ' class="invalid-day week-day-' + (j - 1) + '"', k += '"></td>', 7 == j && (k += "</tr>"), i += k
                }
            }
            n.append(i)
        }

        function f(a, b, c) {
            var d = new Date(c, b, a), e = d.getDay();
            return e += F, 0 == e ? e = 6 : e--, e
        }

        function g(a, b, c) {
            return a > 0 && 13 > a && c > 0 && 32768 > c && b > 0 && b <= new Date(c, a, 0).getDate()
        }

        function h(a, b) {
            for (var c = 28; g(a + 1, c + 1, b);)c++;
            return c
        }

        function i(a, b) {
            0 != A ? $.ajax({
                type: A.type,
                url: A.url,
                data: {mes: a + 1, ano: b},
                dataType: "json"
            }).done(function (c) {
                "undefined" == typeof t && (t = []), $.each(c, function (a) {
                    t.push(c[a])
                }), j(a, b)
            }) : j(a, b)
        }

        function j(a, b) {
            for (var c = a + 1, d = 0; d < t.length; d++)if (t[d].date.split("/")[1] == c && t[d].date.split("/")[2] == b) {
                var e = $("#" + s + "_" + t[d].date.replace(/\//g, "_")), f = $("#" + s + "_" + t[d].date.replace(/\//g, "_") + " a");
                e.addClass("event"), f.attr("data-original-title", t[d].title), t[d].color && e.css("background", t[d].color), "undefined" != typeof t[d].link && "" != t[d].link && f.attr("href", t[d].link), "undefined" != typeof t[d].linkTarget && "" != t[d].linkTarget && f.attr("target", t[d].linkTarget), t[d].class && e.addClass(t[d].class), t[d].content ? (e.addClass("event_popover"), f.attr("rel", "popover"), f.attr("data-content", t[d].content)) : (e.addClass("event_tooltip"), f.attr("rel", "tooltip"))
            }
            $("#" + s + " .event_tooltip a").tooltip(z), $("#" + s + " .event_popover a").popover(y), $(".manual_popover").click(function () {
                $(this).popover("toggle")
            })
        }

        function k() {
            if (1 == B) {
                p.on("click", "td.day", function () {
                    if (1 == C)if ("" == I)I = $(this).data("date"), l(); else if ("" == H) {
                        G = I, H = $(this).data("date"), l();
                        var a = new CustomEvent("bicCalendarSelect", {detail: {dateFirst: G, dateLast: H}});
                        document.dispatchEvent(a)
                    } else G = "", H = "", I = "", p.find(".selection").removeClass("middle-selection selection first-selection last-selection"); else {
                        p.find("td div").removeClass("selection"), $(this).find("div").addClass("selection");
                        var a = new CustomEvent("bicCalendarSelect", {detail: {date: $(this).data("date")}});
                        document.dispatchEvent(a)
                    }
                })
            }
        }

        function l() {
            if ("" != I && "" == G) {
                var a = I.split("/");
                $("#bic_calendar_" + a[1] + "_" + a[0] + "_" + a[2] + " div").addClass("selection")
            } else if ("" != G) {
                {
                    G.split("/"), H.split("/")
                }
                p.find("td.selection").removeClass("selection");
                var b = new Date(G), c = new Date(H);
                if (b > c) {
                    var d = b;
                    b = c, c = d
                }
                for ($("#bic_calendar_" + b.getDate() + "_" + (parseInt(b.getMonth()) + 1) + "_" + b.getFullYear() + " div").addClass("selection first-selection"); c > b;)b.setDate(b.getDate() + 1), $("#bic_calendar_" + b.getDate() + "_" + (parseInt(b.getMonth()) + 1) + "_" + b.getFullYear() + " div").addClass("selection middle-selection");
                $("#bic_calendar_" + b.getDate() + "_" + (parseInt(b.getMonth()) + 1) + "_" + b.getFullYear() + " div").removeClass("middle-selection").addClass("selection last-selection")
            }
        }

        var m, n, o, p = $(this), q = $('<div class="visualmonth"></div>'), r = $('<div class="visualyear"></div>'), s = "bic_calendar", t = b.events;
        if (b.date)if ("string" == typeof b.date) {
            var u = b.date.split("/");
            o = new Date(parseInt(u[2]), parseInt(u[1]) - 1, parseInt(u[0]))
        } else o = b.date; else o = new Date;
        var v;
        v = "undefined" != typeof b.dayNames ? b.dayNames : ["l", "m", "x", "j", "v", "s", "d"];
        var w;
        w = "undefined" != typeof b.monthNames ? b.monthNames : ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
        var x;
        x = "undefined" != typeof b.showDays ? b.showDays : !0;
        var y;
        y = "undefined" != typeof b.popoverOptions ? b.popoverOptions : {
            placement: "bottom",
            html: !0,
            trigger: "hover"
        };
        var z;
        z = "undefined" != typeof b.tooltipOptions ? b.tooltipOptions : {placement: "bottom", trigger: "hover"};
        var A;
        A = "undefined" != typeof b.reqAjax ? b.reqAjax : !1;
        var B = !1;
        "undefined" != typeof b.enableSelect && (B = b.enableSelect);
        var C = !1;
        "undefined" != typeof b.multiSelect && (C = b.multiSelect);
        var D = !0;
        "undefined" != typeof b.displayMonthController && (D = b.displayMonthController);
        var E = !0;
        "undefined" != typeof b.displayYearController && (E = b.displayYearController);
        var F = 0;
        "undefined" != typeof b.startWeekDay && (F = b.startWeekDay);
        var G = "", H = "", I = "";
        a()
    }), this
};